# 17. 내용 협상과 트랜스코딩
서버에 있는 페이지들 중 어떤 것이 클라이언트에게 맞는지 판단하는 3가지 방법

### 클라이언트 주도 협상
클라이언트에게 선택지를 주는것
  - 서버 입장에서 가장 구현하기 쉽고 최선의 사본을 선택할 수 있음
  - 두 번의 요청(목록과 선택된 사본)이 필요하기에 느리다 
  - 증가된 대기시간과 페이지당 여러 번의 요청이 필요하며, 여러 개의 URI을 요구

### 서버 주도 협상
서버가 자동으로 판단하는 방법, 클라에서 무엇을 받을 것인지 헤더에 정보를 담아야함
  - 클라이언트의 요청 헤더를 검증해서 어떤 버전을 제공할지 결정
  - HTTP에서는 위와 같은 경우를 위해서 클라이언트의 선호 정보를 더 자세하게 서버에게 주기 위해 품질값(quality value)라는 것을 이용
  - 클라이언트 주도 협상보다 빠르지만, 클라 헤더의 정보가 부족하다면, 서버는 추측을 해야함
  - 내용 협상 헤더는 엔터티 헤더와 비슷한데, 엔터티 헤더는 선적 화물에 붙이는 라벨과 같고 내용 협상 헤더는 클라이언트 선호에 가장 잘 맞는 문서정보를 제공하는 목적
  - 그 외의 헤더들에 의해 결정
    - Vary
      캐시가 최선의 버전을 제공하려고 하기에, HTTP 프로토콜은 Vary헤더를 정의, 
      Vary헤더는 캐시에게 서버가 최선의 버절을 결정하기 위해 어떤 요청 헤더를 참고있는지 알려줌
    - User-agent : 사용자 브라우저 환경 고려하여 캐시에 저장된 목록 중 알맞는 버전 제공

### 투명 협상(프락시서버)
투명한 중간 장치(주로 프락시)가 서버를 대신하여 클라이언트와 협상하는 방식
  - 클라이언트와의 메시지 교환을 최소화하는 동시에 서버 주도 협상으로 인한 부하를 서버에서 제거할 수 있는 장점
  - 이러한 협상을 위해 서버가 클라 요청에 최선을 판별하기 위해 어떠한 요청 헤더를 검사해야 하는지 중개자(프락시)에게 알려주어야 함
  - 이를 위해 서버는 응답에 Vary 헤더를 포함시켜 중개자(프락시)에게 내용 협상을 위해 어떠한 헤더를 사용하고 있는지를 알려줌


### 트랜스코딩
서버가 클라 헤더의 정보가 없을 경우, 클라에 맞도록 변환하는 것을 트랜스코딩이라고 함 
_트랜스 코딩은 컨텐츠를 특정 접근 장치에서 볼 수 있도로 하기 위한 것임_ 컨텐츠를 효율 또는 안전하게 전송하는 _인코딩과는 다르다_  
 - 포맷 변환 : 데이터를 클라이언트가 볼 수 있도록 한 포맷에서 다른 포맷으로 변환하는 것
 - 정보 합성 : 문서에서 정보의 요점을 추출하는 것
 - 콘텐츠 주입 : 웹 문서의 양을 늘리는 종류의 변환임 (동적으로 콘텐츠 추가)

> 트랜스 코딩 예시를 쫌 봐야지 확 이해갈 듯...?

_정적으로 미리 생성해 놓기_
트랜스 코딩의 대안으로 여러 가지 사본을 만드는 것임 
그러나 미리 생성해 둔다면 작은 변화로 인한 수정과 저장하기 위한 많은 공간, 페이지 관리 측면이 어려워짐
-> 따라서 트랜스 코딩으로 그때마다 변환시키는 것이 더 쉬운 해결책



[vary 헤더](https://runebook.dev/ko/docs/http/headers/vary)
  

