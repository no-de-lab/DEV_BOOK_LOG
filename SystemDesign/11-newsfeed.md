## 팬 아웃 모델
뉴스피드에서 중요한 api 중 하나는 새로이 뉴스피드를 썼을 때 친구들에게 해당 글을 넣는 것이다. 
이는 쓰기 시점에서와 읽기 시점에서의 동작 모델이 있다. 

- 쓰기 시점 모델(Push model): 새로운 포스팅을 기록하는 시점에 뉴스 피드를 갱신한다. 포스팅이 완료되면 바로 해당 사용자의 캐시에 해당 포스팅을 기록한다. 

장점은 실시간 갱신, 친구 목록에 있는 사용자에게 즉시 전송되고 뉴스피드가 바로 갱신되므로 읽는 데 시간이 빨라진다는 것이지만, 
친구가 많은 사용자의 경우 그 목록 자체도 오래걸리고 갱신도 오래 걸린다 (핫 키 문제), 또한 서비스를 자주 이용하지 않는 사용자의 피드까지 갱신해야해서 컴퓨팅 자원이 낭비된다. 

- 읽기 시점 모델(Pull model): 피드를 읽어야하는 시점에 뉴스피드를 갱신하여, On-demand 모델이라 할 수 있다. 

장점은 비활성 사용자를 위한 어떤 컴퓨팅 자원도 소모하지 않는 것이고, 핫키문제도 없지만 뉴스피드를 읽는 데 많은 시간이 소요될 수 있다.

이 둘을 결합할 수도 있다. 
- 대부분의 사용자에 대해 푸시모델을 이용한다. 
- 친구나 팔로워가 안주 많은 경우, 풀 모델로 과부하를 방지한다. 
- 안정 해시를 이용해 요청과 데이터를 보다 고르게 분산->핫키 문제를 줄인다. 

### 팬 아웃 동작 방식
1. 그래프 데이터베이스에서 친구 ID 목록을 가져온다. 
2. 사용자 정보 캐시에서 친구들의 정보를 가져온다. 그리고 사용자 설정에 따라 친구 가운데 일부를 걸러낸다. 
3. 친구 목록과 새 스토리의 포스팅 ID를 메시지 큐에 넣는다. 
4. 팬아웃 작업 서버가 메시지 큐에서 데이터를 꺼내 뉴스피드데이터를 뉴스피드 캐시에 넣는다. 캐시의 경우 <포스팅 Id, 사용자 Id> 로 추가한다. 



