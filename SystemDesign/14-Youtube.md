- 단말
- 비디오를 저장할 CDN: 재생 버튼을 누르면 cdn으로부터 스트리밍이 이뤄진다. 
- API 서버: 비디오 스트리밍을 제외한 모든 요청을 처리한다.

## 비디오 업로드
1. 원본 저장소 (BLOB)에 비디오를 업로드한다. 
2. 트랜스코딩 서버는 원본 저장소에서 해당 비디오를 가져와 트랜스코딩을 시작한다. 
3. 트랜스코딩이 완료되면 트랜스코딩 비디오 저장소로 업로드하는 것과, 트랜스코딩 완료 이벤트를 트랜스코딩 완료 큐에 넣는 절차가 병렬적으로 수행된다. 
- 트랜스코딩이 끝난 비디오를 cdn에 올리고
- 완료 핸들러가 이벤트 데이터를 큐에서 꺼내고
- 완료 핸들러가 메타데이터 데이터베이스와 캐시를 갱신한다. 
4. api 서버가 단말에게 비디오 업로드가 끝나 스트리밍 준비가 되었음을 알린다. 

비디오 업로드와 동시에, 단말은 병렬적으로 비디오 메탇제이터 갱신 요청을 api 서버에 보낸다. 여기에는 파일 이름, 크기, 포맷 등의 정보가 들어있고, 이 정보로 메타데이터 캐시와 데이터 베이스를 업데이트한다. 

## 비디오 스트리밍
다운로드하는 것이 아니라, 비디오를 스트리밍 하는 방법에는 스트리밍 프로토콜이 쓰인다. MPEG_DASH, Apple HLS 등

프로토콜마다 지원하는 비디오 인코딩이 다르고 플레이어도 다르다. 따라서 서비스의 용례에 맞게 프로토콜을 잘 골라야한다. 

비디오는 CDN에서 바로 스트리밍 된다. 그래서 전송지연은 낮다. 

---
비디오 업로드 과정에서 비디오 트랜스코딩을 하는 과정은

전처리기 -> DAG 스케줄러-> 자원관리자 -> 작업 실행 서버 -> 인코딩 된 비디오로 정리할 수 있다. 

- 이때 전처리기는 비디오를 분할하고, DAG를 생성한다. 데이터 캐싱도 한다. 
- DAG 스케줄러는 비디오 추출, 오디오 추출, 메타데이터 추출 등 생성된 계획을 가지고 여러 부분으로 나누어 인코딩을 시작한다. 

## 시스템 최적화
- 비디오 병렬 업로드: 하나의 비디오를 작은 GOP로 분할하여, 병렬적으로 업로드한다. 
- 업로드 센터를 사용자 근거리에 지정
- 모든 절차를 병렬화한다. 결합도를 줄이는 것이다. 메시지 큐를 도입하여 이벤트 각각을 병렬적으로 처리한다.
- 안전성 최적화: 허가받은 사용자만이 업로드할 수 있도록, 미리 사인된 업로드 Url을 이용하게 한다. 
- 비디오를 보호하기 위한 디지털 저작권 관리나, AES 암호화, 워터마크 등
- 비용 최적화: CDN은 비싸므로, 인기비디오만 cdn 사용, 없으면 필요할 때 하기