# 7장 통신을 도와주는 네트워크 주요 기술

IP 네트워크에 통신을 도와주는 주요기술(다양한 서비스와 프로토콜)을 알아보는 장

주요 기술
- NAT
  - 하나의 IP를 사용해 여러 단말 정비를 포함하는 네크워크를 손쉽게 구축하는 기술
- DNS
  - 도메인 이름과 IP 주소를 매핑하는 서비스
- GSLB
  - 가장 가까운 지역의 데이터 센터에 접속해 신속한 서비스를 받게 해주는 기술
- DHCP
  - IP 주소를 자동으로 할당하는 기술 


## NAT(Network Address Translation)
네트워크 주소를 변환하는 기술
기본적으로는 1:1 변환이지만, IP 주소가 고갈되는 문제를 해결하기 위해 1:N ip로 변환(PAT) 하기도 함
보통 사설 IP -> 공인 IP 주소로 전환하는데 많이 사용된다. 

### NAT/PAT 용도와 필요성
- IPv4 주소 고갈문제의 솔루션
  - 주소 보전 전략 단기 서브네팅, 중기 NAT 와 사설ip 장기 IPv6 전환
  - 그 중 NAT기술이 큰 역할을 함
  - 외부 공개에는 공인 ip, 일반 사용자 사설 ip를 이용하여 효율적으로 ip를 사용 할 수 있게 됨
- 보안 강화
  - 사내IP 주소 체계를 숨김으로써 보안 강화
  - 통신을 위해 ip 주소 변환/역변환을 해야 통신 가능
  - 외부에서 들어오는 통신을 방어하여 보안 강화
- 더블 나트 : IP 주소 체계가 같은 두 개의 네트워크 간의 통신 가능
  - 공인 ip 주소는 유일하기에 괜찮으나 사설 경우에는 ip가 중복 될 수 있음 
  - ex) 대외계 - 카드사, 은행 간 연결하는 네트워크 
  - 출발지, 도착지를 한꺼번에 변환하는 더블나트 기술로 ip 충돌 방지
- 불필요한 설정 변경을 줄임

그 외 단점
주소가 변환되면서 단말 간 직접적인 연결성이 무너짐
NAT 환경을 항상 고려하면서 개발해야함 (ex : WebRTC)

### NAT 동작방식
- NAT 기본 동작
  변경된 공인 ip을 패킷에 수정하여 전송/수신함
  - 사용자가 보낸 패킷을 수신한 후 NAT 정책에 따라 통신가능한 공인ip 로 주소 변경하고 변경 전후의 ip를 NAT 테이블에 저장
  - 패킷의 출발지 주소를 변경된 ip주소로 웹서버 전송
  - 서버에서 응답 받은 목적지 주소가 NAT 테이블에 출발지 주소와 매칭을 확인
  - 주소가 확인 된 패킷은 원래 주소로 출발지가 변경되어 최종적으로 수신 됨
- PAT
  - NAT 기본 동작과 비슷하고 변경 방식을 PAT로 동작하여, ip & 포트를 변경한다.
  - 만약 서비스 포트가 모두 사용 중인 경우 제대로 동작하지 않음
  - 이러할 경우 공인 ip 주소를 하나가 아닌 풀(Pool)로 구성해야함
  - pat ip가 목적지일때는 기존 ip를 확인할 수 테이블이 없으므로 SNAT에서만 적용됨
- SNAT와 DNAT
  NAT를 사용해 주소를 변환할 때 어떤 주소를 변환하는지에 따라 두 가지로 구분
  SNAT와 DNAT의 기준은 NAT가 수행되기 이전의 트래픽이 출발하는 시작 시점
  - SNAT (출발지 주소 변경)
    - 사설에서 공인으로 통산할때 주로 사용됨 (공유기처럼 사용됨)
    - 보안상으로 사용됨 
    - 로드밸런서 구성에 따라 snat 사용하기도 함
  - DNAT (도착지 주소 변경)
    - 로드밸서에서 많이 사용됨
    - 12 장에서 자세히 나옴
- 동적 NAT 와 정적 NAT
  - 출발지, 목적지의 ip를 미리 매핑해 고정해 놓은 NAT를 정적 NAT, 그 반대가 정적 NAT
  - 동적 경우 다수의 ip 풀에서 정해지므로 최소한 출발지나 목적지 한 곳이 ip풀이나 range를 설정되어 있다
  - 동적은 수행하는 시점에 nat 테이블일 만들어지고통신이 없으면 사라진다(nat 테이블 타임아웃)

## DNS
네트워크 통신 관계를 맺거나 유지하는 컨트롤 프로토콜 중 하나
도메인 주소를 IP 주소로 변환하는 역할
최근 클라우드 기반 인프가 구성이 많아지면서 dns 설계가 중요해지고 있다.

### DNS구조

### DNS동작방식
### DNS주요 레코드






