# 5장 라우터/L3 스위치: 3계층 장비

라우터 - 경로를 지정해주는 장비
패킷의 목적지 ip 주소를 확인, 자신이 가진 경로 정보를 이용해 패킷을 최적의 경로로 포워딩
네트워크를 구성하는 핵심 장비 

## 라우터의 동작 방식

- 경로지정
  - 가장 중요한 역할
  - 라우팅 테이블(경로 정보를 얻는 역할)을 만들고 패킷의 도착지를 확인해 경로를 지정하고 패킷을 포워딩(경로 정보를 확인하고 패킷을 포워딩하는 역할)
  - 경로를 얻는 3가지 방법
    - IP 주소를 입력하면서 자연스럽게 인접 네트워크 정보를 얻는 방법 (다이렉트 커넥티드)
    - 관리자가 직접 경로 정보를 입력 (스태틱 라우팅)
    - 라우터끼리 경로정보를 자동으로 교환하는 방법 (다이나믹 라우팅)
- 브로드캐스트 컨트롤
  - 라우터는 바로 연결되어 있는 네트워크 정보를 제외하고 경로 습득 설정을 하지 않으면 패킷을 포워딩 할 수 없음
  - 멀티캐스트 정보를 습특하지 않고 브로트캐스트 패킷을 전달하지 않는 기능을 _브로드캐스트 컨트롤/멀티캐스트 컨트롤_ 
- 프로토콜 변환
  - 라우터는 서로 다른 프로토콜로 구성된 네트워크를 연결한다.
  - 패킷이 들어오면 2계층의 헤더 정보를 벗기고 3계층 주소를 확인, 헤더 정보를 새로 만들어 외부로 전송
  - 때문에 들어올 때, 나갈 때 2계층 헤더 정보가 다르다.
  - 이 기능으로 전혀 다른 기술간 변환이 가능하다.


## 경로 지정
라우터는 맞는 경로를 가진 패킷만 받기에, 충분한 경로 정보를 수집하고 있어야지 정삭적으로 작동함
클래스 리스 네트워크로 전환된 후, 서브네팅된 상태로 분산되어 경로 정보가 많아짐
최적의 경로 정보인 라우팅 테이블을 적절히 유지해야한다.
목적지의 정보는 정확히 일치하지 않는 경우가 더 많다.
때문에 서브넷 단위로 정보를 습득, 서머리 작업을 통해 여러개의 서브넷 정보를 뭉쳐 전달함

### 라우팅 동작 & 라우팅 테이블
목적지까지의 경로를 인접한 라우터까지만 경로를 지정하고, 인접 라우터에서 최정의 경로를 다시 파악한 후 라우터로 패킷을 포워딩하는 방식으로 동작함
이 기법을 홉-바이-홉(Hop-by-hop) 라우팅이라고 함. 인접한 라우터를 _넥스트 홉_ 이라고 부름

넥스트 홉을 지정하는 3가지 방법
- 다음 라우터의 ip를 지정하는 방법 (일반적으로 사용함)
- 라우터의 나가는 인터페이스를 지정하는 방법
  - 특수한 경우에 사용, IP를 모르더라도 MAC 주소 정보를 알아낼 수 있을 때만 사용 가능
  - PPP, HLDC와 같은 프로토콜
  - 라우터의 나가는 _물리_ 인터페이스 지정
- 위 2가지를 동시에 지정하는 방법
  - IP주소와 동시에 할 경우 VLAN 인터페이스와 같은 논리적인 인터페이스 사용가능

목적지 주소, 넥스트 홉 IP 주소, 나가는 로컬 인터페이스(옵션)이 라우팅 테이블에 저장됨
> 모든 패킷은 TTL이라는 수명값을 가지고 있음 0이되면 네트워크 장비에서 버려짐

### 라우팅 (경로 정보를 얻는 방법)

- 다이렉트 커넥티드
  - IP를 설정하면 네트워크 주소 정보에 대한 라우팅 테이블이 자동 생성
  - 자동 생성으로 정보를 강제로 지울 수 없음
  - 네트워크 설정을 삭제 또는 인터페이스가 비활성화 되어야 사라짐
- 스태틱 라우팅
  - 관리자가 목적지 네트워크와 넥스트 홉을 라우터에 직접 지정
  - 때문에 정보를 직관적으로 설정, 관리할 수 있음
- 다이나믹 라우팅
  - 큰 네트워크는 스태틱 라우팅 만으로 관리가 어려움. 장애가 생겼을 때 에러 경로 발견하기 어려움
  - 이 단점을 보완하기 위해 라우터끼리 경로 정보나 링크 상태 정보를 교환해 전체 네트워크 정보를 학습
  - 한 라우터에 장애가 발생하면 상황을 인지해 대체 경로로 패킷을 포워딩함
  - 이 방법은 자신이 광고할 네트워크를 선언해야함

토폴로지 테이블 - 라우터가 수집한 경로 정보, 원시 데이터 저장
라우팅 테이블 - 토폴로지 테이블의 경로 정보 중 최적의 경로를 저장

### 스위칭 (라우터가 경로를 지정하는 방법)
패킷을 라우터 외부로 포워팅 하는 작업
패킷의 목적지가 정확하지 않기 때문에 최선 경로로 내보낼 때 여러가지 고려를 해야함

> 롱기스트 프리픽스 매치 기법 - 경로 정보중 가장 가까운 경로를 선택
하지만, 이러한 기법을 사용하는 것이 많이 리소스를 소모함, 때문에 한 번 스위칭 작업을 수행한 정보는 라우팅 테이블 보다 캐시를 먼저 확인함

### 라우팅, 스위칭 우선순위
다이렉트 커넥티드 > 스태틱 라우팅 > 다이나믹 라우팅

## 설정방법
