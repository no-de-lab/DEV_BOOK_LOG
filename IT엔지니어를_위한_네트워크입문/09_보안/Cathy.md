# 9장 보안
개인적으로 재미없었던 장...  ^_^

다양한 위협으로부터 보안을 보호하는 것

### 정보 보안의 필수요소 
- 기밀성
  인가되지 않은 사용자가 정보를 보지 못하게 하는 모든 작업
  - 암호화 작업
- 무결성
  정확하고 완전한 정보 유지에 필요한 모든 작업
  - Md5, SHA 같은 해쉬함수를 이용한 것
- 가용성
  정보가 필요할 때, 접근을 허락하는 일련의 작업
그 외 추가로 정보 보안 황동으로 정의 되는 것  
- 진정성
- 책임성
- 부인 방지
- 신뢰성 유지

네트워크 입장에서의 보안
정보를 수집, 가공, 저장, 검색, 송수신하는 도중에 정보의 훼손, 변조, 유출을 막기 위한 관리적, 기술적 방법을 의미
1차 목표 : 서비스를 정상적으로 구동 할 수 없게 만드는 행위를 네트워크에서 적절히 막는 것
2차 목표 : 정보가 네트워크를 통해 복제, 이동되므로 그 유출을 막는 것

## 보안의 주요 개념
- 트러스트 네트워크 : 외부로부터 보호받아야 할 네트워크
- 언트러스트 네트워크 : 신뢰할 수 없는 외부 네트워크
- DMZ 네트워크 : 내부 네트워크지만 신뢰할 수 없는 외부에 개방해야하는 서비스 네트워크
  -> 일반적으로 인터넷에 공개되는 서비스를 이 네트워크에 배치

네트워크 보안 분야
트래픽의 방향과 용도에 따라 두가지로 나눠진다.
- 인터넷 시큐어 게이트웨이 
  트러스트네트워크에서 언스트러스트 네트워크로의 통신을 통제
  인터넷으로 나갈 때 수많은 서비스가 있으므로 그에 대한 정보와 요청 패킷을 적절히 인식하고 필터링 하는 기능필요
  - 방화벽
  - 웹 필터
  - 애플리케이션 컨트롤
  - 샌드박스 와 같은 장비

- 데이터 센터 시큐어 게이트웨이
  언트러스트 네트워크에서 트러스트(또는 DMZ)로의 통신을 통제
  외부의 직접적인 공격을 막아야 하므로 인터넷 관련 정보보다 공격 관련 정보가 더 중요
  - IPS
  - DCSG
  - WAF
  - Anti-DDoS 등의 장비가 이와 겉은 용도로 사용

네트워크 보안 정책 수립에 다른 분류

- 화이트리스트
  방어에 문제가 없다고 명확히 판단되는 통신만 허용하는 방식
  일반적으로 IP와 통신 정보에 대해 명확히 아는 경우에 많이 사용됨
- 블랙리스트
  공격이라고 명확히 판단되거나 문제가 있었던 ip 리스트나 패킷 리트르르 기반으로 _DB_ 를 만들고 그 정보를 이용해 방어하는 형태
  각종 패텬으로 공격을 방어하는 네트워크 장비들은 일반적으로 블랙리스트 기반의 방어 기법을 제공
  > 공격을 분석해서 DB에 저장 -> 공격 패턴이라고 함

네트워크 장비들은 보안 위협이 증가되면서 화이트리스트으로 정책을 수립하나, 세부적인 통제가 필요하므로 많은 관리 인력이 필요함
때문에 블랙리스트 기반 방어 정책을 수립하고 시그니쳐(DB)를 최신으로 유지하는 것이 안정적인 보안 운영에 바람직

탐지 에러 타입
- 정탐
  Y-Y(True positive) 공격이라 추론하고 공격인 경우
  N-N(False Negative) 공격이 아니라 추론하고 공격이 아닌 경우
- 오탐
  Y-N(False positive) 공격이라 추론하고 공격이 아닌 경우
  공격으로 오인한 탐지이므로 오탐을 줄이는 튜닝작업 필요
- 미탐
  N-Y(True Negative) 공격이 아니라 추론하고 공격인 경우
  공격 패턴이 업데이트 되지 않았거나, 과도한 예외처리로 공격 패킷 탐지가 정상적으로 되지 않았을 때 발생

## 보안 솔루션 종류
보안 장비의 위치와 역할에 따라 다양한 네트워크 보안 장비가 있다.
데이터 센터에서 보안 장비를 디자인할 때  DDos - 방화벽 - IDS, IPS - WAF 형태와 같이 여러 단계로 공격을 박도록 인라인 상에 러 장비를 배치

- DDos 방어 장비
  DDos(서비스 부하를 가해 정상적인 서비스를 방해하는 공격 기법)를 방어하는 장비 
  데이터 센터 네트워크 내부와 외부의 경계에서 공격을 방어하는데 이것은 _볼류메트릭 공격_ 을 우선 막기 위함
  회선을 공급해주는 ISP나 네트워느 ISP와 연결되는 데이터센터 네트워크의 가장 바깥쪽에 위치시켜 공격을 완하해야함
> 볼류메트릭 공격
  회선 사용량이나 그 이상의 트래픽을 과도하게 발생시켜 회선사용을 방해하는 공격, 
- 방화벽
  4계층에서 동작하는 패킷 필터링 장비
  3,4계층 정보를 기반으로 정책을 세울 수 있고 정책과 매치되는 패킷이 방화벽을 통과하면 그 패킷을 허용하거나 거부 할 수 있음
  일반적으로 DDos 방어 장비 바로 뒤에 놓는 보안 장비
- IDS, IPS
  방화벽에서 방어할 수 없는 다양한 애플리케이션 공격을 방어하는 장비
  최근에는 ips로 통칭함
  사전에 시그니쳐를 제조사나 위협 인텔리전스 서비스 업체로부터 받음. 이후 장비에 인입된 패킷이 공격일 경우 차탄하거나 모니터링 한 후 관리자에게 알람을 보냄
  기존은 블랙리스트 기반이었지만 프로파일링 기반의 방어 기법이 IPS에 적용되면서 화이트리스트 기반의 방어 기법도 적용할 수 있게됨
- WAF
  웹 서버를 보호하는 전용 보안 장비
  HTTP, HTTPS처럼 웹 서버에서 동작하는 웹 프로토콜의 공격을 방어
  IDS, IPS보다 범용성이 떨어지지만 웹에 대해서는 세밀히 방어할 수 있음
  *IPS 에서는 방어할 수 없는 IPS회피 공격을 방어 할 수 있음*
- 샌드박스
  스팸메일, 불법 다운로드 등으로 악성코드가 포함된 낚시성 파일을 사용자가 직접 실행하는 경우
  PC 감염(좀비 PC)되고 공격자는 이 PC들이 외부에서 컨트롤 하도록 _C&C_ 서버로 연결하도록 조작 -> APT, ATA 공격으로 발전
  샌드박스는 APT의 공격을 방어하는 대표적인 장비
  악성코드를 샌드박스 시스템 안에서 직접 실행, 가상 운영체제 안에서 각종 파일을 실행, 그 행동을 모니터링하여 악성 코드 여부 파악
  기존 보안 장비, 솔루션을 피하는 회피 공격을 탐지함
- NAC
  네트워크에 접속하는 장치들을 제어하기 위해 개발
  네트워크 접속할 때 인가된 사용자만 내부망에 접속 할 수 있도록 제어하는 기술 
- IP제어
  NAC와 비슷하나 다른 목적으로 개발
  보안사고 추적이 쉽도록 고정 IP 사용 권고 지침이 금융권에 내려오면서 IP를 할당하고 추적하는 솔루션 필요해짐
  할당된 IP 관리하고, 의도된 IP 할당이 아니면 네트워크를 사용하지 못하게 하는 기능
- 접근통제
  서버나 DB에 대한 직접적인 접근을 막고 작업 추적 및 감사를 할 수 있는 접근 통제 솔루션
  서버 접근을 위한 모든 통신은 배스천 호스트를 통해서만 가능, 다른 통신을 모두 방어
- VPN
  사용자 기반의 VPN서비스를 제공해주는 장비를 VPN 장비라고함
  IPSEC - 네트워크 연결용
  SSL - 사용자가 내부 네트워크 연결할 때 주로 사용

## 방화벽
3,4계층 동작하며 세션을 인지하는 상태 기반 엔진으로 동작

###  초기 방화벽(패킷 필터링 방화벽)
패킷의 인과 관계를 확인하지 못한 단순한 필터링 (stateless or packet filter)
방화벽 설정된 정책에 일치하는지만 확인하는데 참조하는 조건을 5-튜플이라고 함

패킷 필터링 방화벽은 인터넷 통신과 같이 불특정 다수 기반의 정책을 정의할 때는 룰셋이 복잡해지고 보안이 약화되는 문제가 있음

통신은 양방향으로 이루어지는데 패킷 필터 엔진은 양방향성을 인지 못하고 단순히 패킷이 조건과 일치하는지만 검사
트래픽을 처리하기 위해 정책을 선언하려면 목적지가 불특정 다수의 웹이 될 수 있으므로 외부로 나가는 목적지에 대해서는 모든 패킷을 허용
 -> 보안상 매우 취약
이러한 한계를 극복하기 위해 개발 된 것이 _상태 기반 방화벽_

###  현대적 방화벽(상태 기반 방화벽)
SPI엔진은 패킷의 인과 관계와 바향성을 인지해 정책을 적용할 수 있음
내부 네트워크에서 인터켓으로 통신할 대 유용하게 사용

###  방화벽 한계
방화벽을 우회하는 공격들이 트렌드화
보안에 SPI 엔진은 필수 요소가 되었지만 OSI 3,4계층에서만 동작하는 한계가 있음 

방화벽의 한계를 보안하기 위해 IPS 보안장비가 개발됨


## IDS, IPS
IDS, IPS 보안 장치는 OSI 3~7계층에서 작동한다
IDS 침입 탐지 시스템
  방어보다 '탐지'에 초점을 맞추어 개발됨
  공격에 직접 방어를 하는 것이 아니라, 트래픽을 복제해 검터하고 침입 여부를 판별
IPS 침입 방지 시스템
  공격이 발견되면 직접 차단하는 능력을 갖춘 장비
  트래픽이 지나가는 인라인 상에 장비를 배치하여, 직접적으로 통신에 개입하여 유해 트래픽 차단, 방어 
  그 외에도 회피 공격을 차단하기 위한 세션 이해 가능 여부
  능동적 방어를 위한 어노말리 등 다양한 기능으로 구분
IPS는 호스트(엔드포인트 보안이 강조), 네트워크 기반(네트워크 보안 강조)이 있음
일반적으로 네트워크기반

### IDS, IPS 동작방식 
패턴 매칭 방식
시그니쳐를 습득하고 그 패턴에 맞는 공격들을 방어함

어노말리 공격 방어
분명한 공격으로 파악되지 않더라도 틀정 기준 이상의 행위를 이상하다고 판단하고 방어를 하는 것
 - 프로파일 어노말리 : 푱소 관리자가 정해놓은 기준 또는 ISP 장비가 모니터링해 정해진 기준과 다른 행위가 일어나면 공격으로 판단
  -> 동적 프로파일 기능이 강화되면서 향후 DDos방어 장비로 진화
 - 프로토콜 어노말리 : 좀비화된 PC에서 공격을 방어하기 위해 사용되는 기법. 
  서비스 포트에서 동작하는 프로토콜이 아닌 다른 프로토콜을 사용하는 경우 공격을 의심

### IDS, IPS 한계
네트워크상에서 빠른 속도로 애플리케이션 레벨까지 확인하기 위해 플로 엔진을 사용
플로 엔진은 패킷을 모아 데이터 형태로 변환해 검사하는 것이 아니라, _패킷이 흘러가는 상황을 모니터링해 공격을 감지_
IPS 장비를 비교적 쉽게 우회할 수 있음 -> 오탐이 많이 발생함

초기 튜닝 작업을 오래해 주어야하고, 별도의 관제 인력이 장비를 모니터링 & 최적화 적업을 지속적으로 수행해야함

## DDos 방어 장비
DDos 공격을 방어하는 장비
볼류메트릭 공격을 방어하기 위해 트래픽 프로파일릭 기법을 주로 사용

DDos는 대규모 공격이므로 탐지, 방어 장비로 구분하는 경우가 많음
주요 차단 방법은 프로파일링 기법 - 평소 데이터 흐름을 습득해 이와 일치하지 않는 과도한 트래픽이 인입되면 알리고 차단
또 다른 방법은 데이터 베이스 기반으로 방어 - 공격으로 사용된 IP 방어 여부 결정하여 방어

## VPN
공중말을 이용해 논리적으로 직접 연결한 것처럼 망을 구성하는 기술
논리적으로 직접 연결된 것처럼 만들어주는 통로를 _터널_ 이라고 함
이러한 망을 구성하기 위해서는 강력한 보안을 제공해야함 
때문에 IPSEC, SSL와 가은 암호화 기법을 제종하는 프로토콜이 자주 사용됨

동작방식
VPN은 가상 네트워크를 만들어주는 장비로 터널링 기법(패킷을 터널링 프로토콜로 감싸 통신하는 기법)을 사용
VPN은 3가지 형태로 구현
H-H(Host to Host) : 두 호스트 간에 직접 VPN 터널을 연동하는 기법 (잘 사용되지 않음)
N-N(Network to Network) : 본사-지사 같은 특정 네트워를 가진 두 종단을 연결하는 경우 (IPSEC 스택이 가장 많이 사용)
H-N(Host to Network) : 모바일 사용가자 일반 인터넷망을 통해 사내망으로 연결하는 경우(IPSEC, SSL이 범용적으로 사용)
