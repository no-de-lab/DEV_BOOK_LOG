# 13장 네트워크 디자인

## 2/3계층 네트워크

- 2계층 네트워크
호스트간 통신이 직접 2계층 통신만으로 이루어지는 네트워크 디자인
통신할 호스트가 동일한 네트워크여야함
때문에 게이트웨이를 거치지 않고 직접 호스트 간 통신이 가능한 구조

_하나의 브로드캐스트 도메인_ -> 루프구조가 생기면 문제 발생으로 _STP(스패닝 트리 프로토콜)_ 로 문제해결
STP 사용으로 블록포인트가 생기면서 전체 인프라의 대역폭을 사용하지는 못하는 문제 발생
-> _MC-LAG_ 와 같은 기술을 이용해 루프를 제거하여 _논 블록킹 구조_ 를 만들어야함 

> 논 블록킹 구조

- 3계층 네트워크

IP 라우팅과 같은 3계층 통신으로 이루어지는 네트워크 디자인 (루프문제 발생X)
_ECMP 라우팅 기술_ 을 이용해 인프라 대역폭을 모두 사용
다만, 장비마다 각기 다른 네트워크를 가지고 있기에 브로드캐스트로 상대방 호스트를 직접 찾을 수 없음
이 경우, VxLAN와 같은 _오버레이 네트워크 기술_ 을 사용해 하단 호스트 간에 동일한 네트워크를 사용하다록 구성할 수 있음

2계층 네트워크 확장하면서 3계층의 장점인 루프 없이 대역폭 모두 사용하는 장점이 생김

> _오버레이 네트워크 기술_ 터널링 프로토콜 기반

## 3-Tier 아키텍쳐
코어(상단) - 애그리게이션(중간) - 액세스(하단) 3계층으로 이루어진 네트워크 아키텍쳐 (전통적인 네트워크 디자인 기법)
상위 레이어로 올라갈수록 장비들이 접선되므로 높은 대역폭이 필요
그렇지 않으면 병목 현상이 발생함으로 연결 구성인 _업링크에서는 Oversubscription ratie을 잘 산정해 구성_ 해야함

데이터 센터의 경우, North-South 트래픽이 대부분인 경우 3-Tier 네트워크 디자인이 적합한 구조

> North-South : 사용자로부터 서비스를 요청받고 서버에서 사용자 요청에 응답

## 2-Tier 아키텍쳐

- 스파인-리프 구조
  하단 호스트가 연결되는 리프 스위치는 상단 스파인 스위치와 연결
  리프-스파인 스위치간 _스패닝 트리가 동작하지 않고 모든 링크를 사용해 트래픽 전송_
  East-West 트래픽이 많은 현대 네트워크에 적합
> East-West 트래픽 : 서버 간 통신
  East-West 트래픽 증가한 이유 서버 가상화, 빅데이터 대중화, 애플리케이션 아키텍쳐와 개발 방법의 변화
- L2 패브릭
  스파인-리프 구조에서 스파인-리프 사이를 2계층 네트워크로 구성하는 방법
  TRILL 또는 SPB 프로토콜 사용
- L3 패브릭
  스파인-리프 구조에서 스파인-리프 사이를 3계층 네트워크로 구성하는 방법

## 망 (데이터 센터 구성)

- 인터넷망
  인터넷에서 사용자가 데이터 센터에 접근할 수 있도록 구성된 영역
  ISP에서 인터넷회선을 받아 연동
  소규모는 IP를 할당 / 대규모 BGP프로토콜 이용 별도의 AS번호를 가짐
- 공인망(서비스망)
  외부 사용자에게 직접 노출되는 웹 서비스 등의 서버들이 모인 망
  untrust/trust구간을 나누기에 DMZ라고도 불림
- 내부망
  내부나 사내에서만 접근할 수 있는 네트워크 망
- 데이터베이스망
  데이터 베이스의 보안을 강화하기 위한 내부망에 추가로 방화벽을 두고 별도로 구성한 망
- 대외망
  회사 대 회사로 서비스 연동일 필요한 경우 전용선 또는 VPN을 이용한 것
- 관리망
  장비 관리용 망

## 케이블링과 네트워크
데이터 센터 내에는 서버, 스토리지와 같은 장비를 수용할 수 있는 랙이 많음
센터 내에서 스위치와 서버 간 케이블링 구성 방식(스위치의 물리적 위치에 따른 구성)
- ToR(Top of Rack)
  랙 상단에 개별적으로 설치되는 스위치 구성
  서버가 스위치와 동일한 랙에 있으므로 케이블링의 길이나 복잡성이 줄어듬
  그러나 스위치가 더 많이 필요함으로 장비 관리사항이 늘어남 (전력, 냉각비용 증가로 운영비용 증가)
  랙별로 사전에 스위치를 구성해야 하므로 미사용 중인 포트가 늘어 포트의 집적도가 떨어질 수 있음
- EoR(End of Row)
  서버가 있는 랙과 네트워크 장비가 있는 랙을 분리한 구성
  랙이 있는 행 끝에 네트워크 장비를 두고 각 서버있는 랙에 연결
  대형 새시 스위치에서 라인 카드를 추가하는 방식
  ToR보다 필요한 스위치 장비 수가 줄어듬 -> 관리비용 줄어듬
  그러나 서버와 케이블 구성이 멀어지므로 케이블링 복잡도 증가(구축비용 증가)
- MoR(Middle of Row)
  EoR과 동일하다 네트워크 장비의 랙을 중간에 위치
  EoR에 비해 구축비용 감소
