> 스위치: 네트워크 가장 핵심장비. 맥 주소를 기반으로 동작
네트워크 중간에서 패킷을 받아 필요한 곳에만 보내주는 네트워크의 중재자

### 기본 기능
- 맥 주소를 인식하고 패킷을 전달
- 한 대의 장비에서 논리적으로 네트워크를 분리할 수 있는 VLAN
- 네트워크의 루프를 방지하는 STP

이 외에도 많지만, 패킷 처리를 위한 필수 기능만 다룰 예정. 정확히는 패킷 아닌 프레임이라고 부른다.

* PDU
  - 헤더 + 데이터

## 스위치 장비 동작
패킷을 동시에 여러 장비가 간섭없이 통신하도록 도와주는 장비 = 스위치
> 한꺼번에 단말이 통신 가능.
> 충돌하거나 통신을 기다리는 문제가 해결됨

* 핵심 역할
  -> 누가 어디에 있는지 정확히 파악. 실제 통신이 시작되면 위치로 패킷을 정확히 전송
  > 맥 주소 테이블로 가능

### 플러딩
부팅한 스위치 = 백지 상태. 
이 때는 허브처럼, 모든 포트로 패킷을 흘린다. 이걸 플러딩이라고 함.
스위치는 패킷이 들어올 경우 도착지 맥 주소 확인 > 자신의 맥 주소 테이블에서 해당 맥 주소가 있는지 확인하고 없으면, 모든 포트에 같은 내용의 패킷 전송.
-> 이는 실제로는 ARP 브로드 캐스트 기능 때문에 그럴일이 별로 없다. 

과도하지 않도록 스위치는 패킷이 스위치에 들어오면 해당 패킷 정보의 맥주소를 학습하고 테이블을 만든다.
이걸 어드레스 러닝이라 한다.

### 어드레스 러닝
패킷의 출발지 MAC 주소 정보를 이용.
패킷이 특정 포트에 들어올시> 스위치는 맥 주소 테이블에 맥 주소와 포트 번호 기록

-> 사전 정의된 맥주소 테이블을 이용하기도. 이 경우 패킷 처리 용도가 아니라, 스위치간 통신을 위함.

### 포워딩 / 필터링
패킷 > 스위치 > 도착지 맥 주소 확인, 자신이 가진 맥 테이블과 비교해 맞는 정보가 있으면 매치되는 해당 포트로 포워딩
자연스럽게 다른 포트로는 보내지 않는다. 이를 필터링이라 한다.
유니캐스트에 대해서만 이 작업 수행. 
그 외에는 플러딩


## VLAN
가상화란 : 하나의 물리 스위치에서 여러 네트워크를 나눠 사용할 수 있는 것
Virtual LAN
- 기업처럼, 여러 부서가 함께 근무할 때는, 네트워크 여러개를 운영해야.
- PC 말고도 복합기, 전화기 같은 단말이 네트워크에 연결되니, 네트워크 분할은 중요하다.
- VLAN을 나누게되면 하나의 장비를 서로 다른 네트워크를 갖도록 논리적으로 분할한 것이라, 유니캐스트나 브로드캐스트도 VLAN간 소통이 불가하다.
- 이렇게 나누면 물리적 구성과는 관계없이 네트워크를 분리할 수 있다.

### 종류와 특징
- 포트 기반과 맥 기반으로 나뉨.
- 초창기에는 포트 기반. 일반적으로 우리가 VLAN을 부를 때 포트 기반이라 한다.
- 사용자들의 자리 이동이 많아지면서 맥 기반이 발전. 단말 중심으로 VLAN 할당. 단말에 따라 달라지므로 다이나믹 VLAN이라고도.

### 동작 방식
- 서로 다른 VLAN 통신은 3계층 장비를 사용해야한다.
- VLAN 개수만큼 포트에 연결해야 하기 때문에, 장비 간의 연결 만으로 많은 포트가 낭비된다
- 이를 해결하기 위해 태그 기능 등장
- 하나의 포트에 여러 개의 VLAN을 함께 전송할 수 있게 해준다.
- 이 기능이 생기면서 맥테이블에 VLAN을 지정하는 필드가 추가됨.

## STP
하나의 시스템이나 구성 요소에서 장애가 생기면, 전체 시스템이 동작을 멈춘다.

이를 막기 위해 이중화, 다중화된 네트워크를 디자인하는데,
패킷이 네트워크를 따라 계속 전송되므로 루프가 발생해 네트워크 마비시킬 수가 있다.

### 루프란?
브로드캐스트 스톰으로 인해 보통 발생.
- 서로 빙글빙글 도는 루프
- 스위치는 패킷이 유입된 포트를 제외한 모든 포트로 플러딩하는데, 플러딩된 패킷도 똑같이 행동하므로 이걸 브로드캐스트 스톰이라고 한다.

이 외에도 스위치 맥 러닝 중복 문제도 있다.
루프 구조 상태에서는 유니캐스트도 문제다.
하나의 맥 주소에 여러개의 포트가 들어가게 되므로 어드레스 플래핑 현상이 나온다. 
이를 수동으로 해결하려고 하는 것은 바람직하지 않다.

이를 자동으로 감지하기 위해 STP 등장

### STP
루프 확인, 포트 사용 금지해 루프 예방하는 매커니즘
- 트리 구조로 확인
- 전체 스위치가 어떻게 연결되는지 알아야 하므로, BPDU라는 프로토콜 이용
- 스위치 간의 정보 전달, 수집된 정보를 이용해 전체 네트워크 트리 만듦

#### 학습과정
- 블로킹
  - > 패킷 데이터 차단하고, BPDU 기다린다.
  - 못받으면 리스닝 상태 변경
- 리스닝
  - 해당 포트가 전송 상태로 변경되는 것을 결정, 준비
  - 자신의 BPDU 전달
  - 15초 대기
- 러닝
  - 해당 포트를 포워딩 하기로 결정. 
  - 15초 대기
- 포워딩

총 50초 쯤 걸림
다만 이 때문에 빠른 OS의 경우 정상적으로 포워딩 상태가 되지않아서, 할당받지 못하는 경우 생긴다.

### 향상된 STP
#### RSTP
- 시간이 너무 오래 걸리는 문제 해결하기 위해, BPDU 메세지 형식 다양화로 상태 메세지를 다양히 교환
- 루트에서 끝까지 갔던 기존과 다르게 루트가 아니더라도 모든 네트워크에 토폴로지 변경 전파 가능

#### MST
- VLAN 개수와 관계없이 스패닝 트리 한 개만 동작하는 STP
- 이 경우 자원 관리가 좀 효율적이지 않아서, 
- 각 VLAn마다 다른 STP 동작시키게 됨 (PVST)
- 근데 이건 많은 부담
- CST + PVST 의 단점 보완 = MST
- 여러 개의 VLAN을 그룹으로 묶고, 그룹마다 ST 동작
- 
